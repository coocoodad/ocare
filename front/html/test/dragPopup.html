<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover" />
	<meta name="format-detection" content="telephone=no" />
    <title>타이틀</title>
    <link rel="stylesheet" data-description="공통 요소별 스타일" href="/front/app/css/common.css">
    <link rel="stylesheet" data-description="공통 요소별 스타일" href="/front/app/css/main.css">
    <script src="/front/app/js/library/jquery-3.3.1-min.js"></script>
    <script src="/front/app/js/library/jquery-ui.min.js"></script>
    <script src="/front/app/js/common_ui.js"></script>
    <style>
        #wrap{background-color:#ffd700}
        .drag_wrap{position:relative;width:100%;height:6.0rem;background-color:#ffd700}
        .drag_pop_wrap{position:fixed;top:0;right:0;width:6.0rem;height:6.0rem;background-color:#fff8d6;text-align:center;border-radius:0 0 3.0rem 3.0rem;z-index:10}
        .drag_pop_wrap::before, .drag_pop_wrap::after{content:'';position:absolute;top:0;left:-3.0rem;width:3.0rem;height:3.0rem;background-color:#fff8d6}
        .drag_pop_wrap::after{left:-3.1rem;width:3.1rem;height:3.1rem;background-color:#ffd700;border-radius:0 1.5rem 0 0;transition:.4s ease-out}
        .drag_pop_wrap.on, .drag_pop_wrap.full{width:100%;border-radius:0}
        .drag_pop_wrap.on::after, .drag_pop_wrap.full::after{border-radius:0}
        .drag_pop_wrap.full{background-color:#333}
        .drag_trigger{position:absolute;top:50%;left:50%;width:4.0rem;height:4.0rem;background-color:#555;overflow:hidden;border-radius:100%;transform:translateX(-50%) translateY(-50%) scale(1);transition:.4s ease-out}
        .ani-block{transform:scale(0);transition:.4s ease-out}
        .ani-block.on{transform:scale(1)}
    </style>
</head>
<body>
    <div id="wrap">
        <div class="drag_wrap">
            <div class="drag_pop_wrap">
                <button type="button" class="drag_trigger" onclick="dragPopOpen('#kbDrag')">
                    <img src="/front/html/test/coocoo.jpg" alt="" />
                </button>
            </div>
        </div>
        <div>
            <div style="height:100px;margin:20px;padding:15px;border-radius:10px;background-color:#fff8d6">
                <ul style="display:flex ">
                    <li style="width:100%;height:70px;border-radius:8px;background-color:#fff"></li>
                    <li style="width:100%;height:70px;margin-left:15px;border-radius:8px;background-color:#fff"></li>
                    <li style="width:100%;height:70px;margin-left:15px;border-radius:8px;background-color:#fff"></li>
                </ul>
            </div>
            <div style="padding:20px;background-color:#fff;border-radius:20px 20px 0 0">
                <div style="margin-top:10px">
                    <div style="width:50%;height:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:100%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:100%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:80%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:100%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:30%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                </div>
                <div style="margin-top:30px">
                    <div style="width:50%;height:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:100%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:100%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:80%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:100%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:30%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                </div>
                <div style="margin-top:30px">
                    <div style="width:50%;height:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:100%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:100%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:80%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:100%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:30%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                </div>
                <div style="margin-top:30px">
                    <div style="width:50%;height:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:100%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:100%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:80%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:100%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:30%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                </div>
                <div style="margin-top:30px">
                    <div style="width:50%;height:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:100%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:100%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:80%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:100%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                    <div style="width:30%;height:10px;margin-top:10px;background-color:#ccc;border-radius:10px"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- KB 금융비서 팝업 -->
    <div id="kbDrag" class="popup full kb_sec" role="dialog" aria-hidden="true">
        <article class="pop_wrap">
            <div class="kb_sec_morphing">
                <div class="kb_sec_head">
                    <h2 style="text-align:center">Profile</h2>
                </div>
                <div class="kb_sec_content">
                    <div class="ani-block" style="width:100px;height:100px;margin:30px auto 0;overflow:hidden;border-radius:100%">
                        <img src="/front/html/test/coocoo.jpg" alt="" />
                    </div>
                    <div class="ani-block" style="margin-top:20px;text-align:center;color:#fff">
                        <strong>COOCOO</strong><br>
                        <span style="font-size:1.4rem">korean short hair</span>
                    </div>
                    <div class="ani-block" style="height:100px;margin-top:30px;padding:15px;border-radius:100px;background-color:#555">
                        <ul style="display:flex ">
                            <li style="width:100%;height:70px;border-radius:70px;background-color:#fff;opacity:.2"></li>
                            <li style="width:100%;height:70px;margin-left:15px;border-radius:70px;background-color:#fff;opacity:.5"></li>
                            <li style="width:100%;height:70px;margin-left:15px;border-radius:70px;background-color:#fff;opacity:.3"></li>
                        </ul>
                    </div>
                    <div style="display:flex;margin-top:30px">
                        <div class="ani-block" style="width:100%;height:100px;background-color:#6a5df0;border-radius:20px"></div>
                        <div class="ani-block" style="width:100%;height:100px;margin-left:15px;background-color:#6a5df0;border-radius:20px"></div>
                    </div>
                    <div class="ani-block" style="width:100%;height:100px;margin-top:15px;background-color:#830da0;border-radius:20px"></div>
                </div>
                <button type="button" class="pop_close" onclick="dragPopClose('#kbDrag')" aria-label="팝업창 닫기"></button>
            </div>
        </article>
    </div>
    <!-- //KB 금융비서 팝업 -->
</body>
<script>
    const $dragWrap = $('.drag_wrap');
    const $dragPopWrap = $('.drag_pop_wrap');
    const $dragButton = $dragPopWrap.find('.drag_trigger');
    const $trigger = $(document);

    let isMove = false;
    const $animateSpeed = 300;
    let $startH = 0;
    let $startY = 0;
    let $distanceY = 0;
    let $directionX = false;
    let $directionY = false;

    $trigger.on('touchstart mousedown', function (e) {
        isMove = true;
        const $this = $(this);
        const $clientY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
        $startY = $clientY;
        $startH = $dragPopWrap.outerHeight();
        $directionY = false;
        if ($this.data('first-height') === undefined) $this.data('first-height', $startH);
    });

    $trigger.on('touchmove mousemove', function (e) {
        if (!isMove || $dragPopWrap.hasClass('full')) return false;
        const $clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;
        $distanceY = $clientY - $startY;
        if ($distanceY !== 0) $directionY = $distanceY > 0 ? 'down' : 'up';
        if ($(window).scrollTop() === 0 && $directionY === 'down') {
            $('body').css('overflow', 'hidden');
            const $minHeight = Math.max($startH, $startH + Math.round($distanceY/5));
            ($distanceY > 50) ? $dragPopWrap.addClass('on') : $dragPopWrap.removeClass('on');
            let $minScale = Math.max(1, 1 + ($distanceY/800));
            ($minScale >= 1.4) ? $minScale = 1.4 : $minScale;
            $dragWrap.css('height', $minHeight);
            $dragPopWrap.css({
                'height': $minHeight,
                'transition': 'width .4s ease-out, border-radius .4s ease-out, background-color .4s ease-out'
            });
            $dragButton.css('transform', 'translateX(-50%) translateY(-50%) scale(' + $minScale + ')');
            ($directionY === 'up') ? $trigger.css('overflow', 'hidden') : $trigger.css('overflow', 'auto');
        }
    });

    $trigger.on('touchend mouseup mouseleave', function (e) {
        if (!isMove) return false;
        const $clientY = e.type === 'touchend' ? e.changedTouches[0].clientY : e.clientY;
        $distanceY = $clientY - $startY;
        if ($distanceY !== 0) $directionY = $distanceY > 0 ? 'down' : 'up';
        if ($directionY === 'down' && !$dragPopWrap.hasClass('full')) {
            if ($distanceY > 300) {
                dragPopOpen('#kbDrag');
            } else {
                $dragWrap.css('height', $startH);
                $dragPopWrap.css({
                    'height': $startH,
                    'transition': 'width .4s ease-out, height .4s ease-out, border-radius .4s ease-out, background-color .4s ease-out'
                });
                $dragPopWrap.removeClass('on').css('height', $startH);
                $dragButton.css('transform', 'translateX(-50%) translateY(-50%) scale(1)');
            }
        }
        $('body').removeAttr('style');
    });

    var dragPopOpen = function(tar){
        $dragPopWrap.addClass('full').css({
            'height': '100%',
            'transition': 'width .4s ease-out, height .4s ease-out, border-radius .4s ease-out, background-color .4s ease-out'
        });
        $dragButton.css('transform', 'translateX(-50%) translateY(-50%) scale(0)');
        UICommon.Layer.open('#kbDrag');
        setTimeout(function(){
            const $aniBlock = document.querySelectorAll('.ani-block');
            for (let i = 0; i < $aniBlock.length; i++) {
                setTimeout(function(){
                    $aniBlock[i].classList.add('on');
                }, 100*i);
            }
        }, 300);
    };

    var dragPopClose = function(tar){
        UICommon.Layer.close(tar);
        setTimeout(function(){
            $dragWrap.css('height', $trigger.data('first-height'));
            $dragPopWrap.removeClass('on full').css('height', $trigger.data('first-height'));
            $dragButton.css('transform', 'translateX(-50%) translateY(-50%) scale(1)');
            const $aniBlock = document.querySelectorAll('.ani-block');
            $aniBlock.forEach( a => {
                a.classList.remove('on');
            });
        }, 300);
    };

    $(window).scroll(function () {
        if($(window).scrollTop() < $('.drag_wrap').height()) {
            let $minScale = Math.max(0, 1 - ($(window).scrollTop()/100));
            $('.drag_wrap').css('transform', 'transform-origin:0 100% scale(' + $minScale + ')');
        }
    });
</script>
</html>